## Steps
* [Setup MFA](aka.ms/mfasetup)


## Micrososft Azure
* [Learn free Azure 1](https://docs.microsoft.com/en-us/learn/modules/welcome-to-azure/)
* [Learn free Azure 2](https://docs.microsoft.com/en-us/learn/paths/administer-infrastructure-resources-in-azure/)
* [Azure free Account](https://azure.microsoft.com/en-us/offers/ms-azr-0044p/)
* [Azure pricing calculator](https://azure.microsoft.com/en-us/pricing/calculator/)
* [Microsoft Azure Cost Estimator Tool](https://www.microsoft.com/en-ca/download/details.aspx?id=43376)
* [How I choose which services to use in Azure](https://channel9.msdn.com/Shows/Azure-Friday/How-I-choose-which-services-to-use-in-Azure)
* [Azure PowerShell – Cross-platform “Az” module replacing “AzureRM”](https://azure.microsoft.com/en-us/blog/azure-powershell-cross-platform-az-module-replacing-azurerm/)
* [Azure AD Domain Services Documentation](https://docs.microsoft.com/en-us/azure/active-directory-domain-services/)
* [Can someone explain Azure's "database-as-a-service " to me?](https://www.reddit.com/r/sysadmin/comments/9dvuej/can_someone_explain_azures_databaseasaservice_to/)
* [Role-based access control documentation](https://docs.microsoft.com/en-us/azure/role-based-access-control)
* [Self-paced Labs](https://www.microsoft.com/handsonlabs/selfpacedlabs)

## Azure AD Connect
* [Azure AD Connect](https://www.reddit.com/r/sysadmin/comments/a61gub/azure_ad_connect/)
* [Integrate your on-premises directories with Azure Active Directory](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect)
* [Azure Active Directory Seamless Single Sign-On](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-sso)
* [Azure AD Connect - Re-installation of this service safe?](https://www.reddit.com/r/sysadmin/comments/910kzi/azure_ad_connect_reinstallation_of_this_service/)
* [Azure Monitor: Route AAD Activity Logs using diagnostic settings](https://azure.microsoft.com/en-us/blog/azure-monitor-aad-activity-logs-using-diagnostic-settings/)

## Azure general
* [Remote access to on-premises applications through Azure Active Directory's Application Proxy](https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/application-proxy)
* [Premium Block Blob Storage - a new level of performance](https://azure.microsoft.com/en-us/blog/premium-block-blob-storage-a-new-level-of-performance/)
* [Considering Azure Functions for a serverless data streaming scenario](https://azure.microsoft.com/en-us/blog/considering-azure-functions-for-a-serverless-data-streaming-scenario/)
* [Manage emergency-access administrative accounts in Azure AD](https://docs.microsoft.com/en-us/azure/active-directory/users-groups-roles/directory-emergency-access)
* [Leverage Azure Security Center to detect when compromised Linux machines attack](https://azure.microsoft.com/en-us/blog/leverage-azure-security-center-to-detect-when-compromised-linux-machines-attack/)
* [Workload insights into SQL Data Warehouse delivered through Microsoft Azure Monitor diagnostic logs](https://azure.microsoft.com/en-us/blog/workload-insights-with-sql-data-warehouse-delivered-through-azure-monitor-diagnostic-logs-pass/)
* [Row-Level Security is now supported for Microsoft Azure SQL Data Warehouse](https://azure.microsoft.com/en-us/blog/row-level-security-is-now-supported-for-azure-sql-data-warehouse/)
* [Automatically discover workload insights for advanced performance tuning directly in Azure portal](https://azure.microsoft.com/en-us/blog/automatically-discover-workload-insights-for-advanced-performance-tuning-directly-in-the-azure-portal/)
* [Validating Azure Run As accounts in Micrososft Azure](http://techgenix.com/validating-azure-run-as-accounts/)
* [Best practices for alerting on metrics with Azure Database for MySQL monitoring](https://azure.microsoft.com/en-us/blog/best-practices-for-alerting-on-metrics-with-azure-database-for-mysql-monitoring/)
* [Who has switched from ADFS to Azure SSO? Why? How was the transition? How has it worked so far?](https://www.reddit.com/r/sysadmin/comments/9rd3e5/who_has_switched_from_adfs_to_azure_sso_why_how/)
* [Azure Advisor](https://azure.microsoft.com/en-us/blog/new-recommendations-in-azure-advisor/)
* [Azure management groups now in general availability](https://azure.microsoft.com/en-us/blog/azure-management-groups-now-in-general-availability/)
* [Managed Disks migration now available in the Azure Portal](https://azure.microsoft.com/en-us/blog/managed-disks-migration-portal/)
* [Azure Block Blob Storage Backup](https://azure.microsoft.com/en-us/blog/microsoft-azure-block-blob-storage-backup/)
* [Azure AD Activity Logs in Azure Monitor Diagnostics now in public preview](https://cloudblogs.microsoft.com/enterprisemobility/2018/07/26/azure-ad-activity-logs-in-azure-monitor-diagnostics-now-in-public-preview/)
* [Is there a way to send an alert (email) when a device joins Azure AD?](https://www.reddit.com/r/sysadmin/comments/9djadq/is_there_a_way_to_send_an_alert_email_when_a/)
* [Get notified when your Azure resources become unavailable](https://azure.microsoft.com/en-us/blog/get-notified-when-your-azure-resources-become-unavailable/)
* [Renew federation certificates for Office 365 and Azure Active Directory](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-fed-o365-certs)
* [Assign licenses to users by group membership in Azure Active Directory](https://docs.microsoft.com/en-us/azure/active-directory/users-groups-roles/licensing-groups-assign)
* [Azure as a second DC?](https://www.reddit.com/r/sysadmin/comments/9w3w2n/azure_as_a_second_dc/)
* [Four operational practices Microsoft uses to secure the Azure platform](https://azure.microsoft.com/en-us/blog/four-operational-practices-microsoft-uses-to-secure-the-azure-platform/)
* [Five lessons for building your roadmap to a secure hybrid cloud future](https://azure.microsoft.com/en-us/blog/five-lessons-for-building-your-roadmap-to-a-secure-hybrid-cloud-future/)

## Azure Powershell
* [Azure and Windows PowerShell: The Basics](https://www.red-gate.com/simple-talk/sysadmin/powershell/azure-windows-powershell-basics/)
* [Azure and Windows PowerShell: Getting Information](https://www.red-gate.com/simple-talk/sysadmin/powershell/azure-and-windows-powershell-getting-information/)
* [Create Azure VMs with PowerShell Part 1](https://www.red-gate.com/simple-talk/sysadmin/powershell/create-azure-vms-powershell-part-1/)
* [Create Azure VMs with PowerShell Part 2](https://www.red-gate.com/simple-talk/sysadmin/powershell/create-azure-vms-powershell-part-2/)

## SSO
* [Azure Active Directory Seamless Single Sign-On](https://docs.microsoft.com/en-us/azure/active-directory/connect/active-directory-aadconnect-sso)
* [Overview of Single Sign-On](https://azure.microsoft.com/en-us/resources/videos/overview-of-single-sign-on/)
* [What is application access and single sign-on with Azure Active Directory?](https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/what-is-single-sign-on)

## Others
* [Managing Linux VM Authentication in Micrososft Azure](http://techgenix.com/managing-linux-vm-azure/).

### Active Directory Azure configuration information
* Azure Virtual Networks can be configured to use DCs for DNS services
* Update the Virtual Network DNS to use Azure based DCs first
* Make at least one DC in Azure a Global Catalog
* Create if possible multiple DCs in Azure if one's being maintained
* If placing multiple DCss in Azure deploy them in an Availability Set
* Generally RODC is NOT a good fit for Azure (Apps don't work very well and there is traffic)

##### Site Configuration
* In Active Directory Sites and Services configure each Azure region to be its own Active Directory site
* If you're using multiple regions, then make sure that is visible within the name
* Define the IP subnets that are being used for that site, so you have a site to subnet link
* At the Inter-Site Transport configure a site link between a location which is physically connected to Azure.

##### Database placement within an Azure based domain controller
* Add/Create a new data disk to the Azure based DC with with NO caching NO read NO write (Host Caching: None)
* When running DC Promo configure the NTDS and SYSVOl to be placed on this data disk
* Dont store the NTDS and SYSVOL on the OS drive

##### IP reservation and network configuration
* Assign a reserved IP static address to the DC using Azure Configuration

##### Generic DNS record suppression
* To supress the creation og generic DNS records you can read about this article:
[How to optimize the location of a domain controller or global catalog that resides outside of a client's site](https://support.microsoft.com/en-us/help/306602/how-to-optimize-the-location-of-a-domain-controller-or-global-catalog)

### Enabling Cloud Service Relationships with Federation
* Managing identity
* Provisioning and deprovisioning accounts
* Identifying cloud services used within an organization
* Managing federations
* Reporting and auditing
* Providing a simple user experience
* Account STS / Resources STS (STS stand for Security Token Service)
* Choice of sign-in of WS-Fed, OAuth or SAML, which one to use depends on the application or vendor
* Use a dedicated server for Azure AD Connect if possible
* After configuring Azure AD Connect open the Synchronization Service to configure which OU's to sync. This can be done by going to the Connectors and select the AD and go to Configure Directory Parititions and then Containers
* Running a "C:\Program Files\Microsoft Azure AD Sync\Bin\DirectorySyncClientCmd.exe delta [LearnCompany.LTD]". This will for a synchronization the easiest way between AD and Azure AD.
* Authentication Options below:
1. Authentication Option 1: AD DS > Identity sync with password hash > Microsoft Azure AD
2. Authentication Option 2: AD DS > Identity Sync with ADFS > Micrososft Azure AD < Best option
* [Azure AD Connect and federation](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-fed-whatis)
* [Manage AD FS trust with Azure AD using Azure AD Connect](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-azure-ad-trust)

### Discovery Cloud Applications Used in Your Organization
* Azure AD Cloud App Discovery is a feature of Azure AD premium, and lets you install an agent on devices. It will run in the background and search for services which are users are using. This is based on HTTP or HTTPS, if the application/services does not use HTTP or HTTPS the application won't be discoverd.
* Informing the organization that you are going to collect this information is optional. Can be specific at the donwload part of the agent.
* [Cloud App Discovery System Center Deployment Guide](https://social.technet.microsoft.com/wiki/contents/articles/30968.cloud-app-discovery-system-center-deployment-guide.aspx)
* [Cloud App Discovery Group Policy Deployment Guide](https://social.technet.microsoft.com/wiki/contents/articles/30965.cloud-app-discovery-group-policy-deployment-guide.aspx)
* It will create an server on the devices named: Micrososft Cloud App Discovery Endpoint Agent
* Within Azure AD you will get a report about the information which Applications are being used. Do know that there will be noise on this report, since it will report also applications which you have never used. But this application probaly fetches some information which causes to show up in the repot.
* With a filter you can change the ammount of days its showing

### Reports
* [What are Azure Active Directory reports?](https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/overview-reports)

### Storage
* Persistent vs Non-Persistent, most of the time you will choice for persistent
* Persistent: able to write data / power off a system and bring online and the data still is there / move virtual machines between nodes, and its storage is always there.
* Non-Persistent: Think of a temporary disk while rebooting it stays there, but shut it down and then start it again you will lose it.
* Other considerations: Durability. Resiliency, Performances, Connectivity, File- vs Block-based
* [Windows Azure Storage: A Highly Available Cloud Storage Service with Strong Consistency](https://sigops.org/s/conferences/sosp/2011/current/2011-Cascais/printable/11-calder.pdf)

### Azure Storage offerings
* Storage Services available: StorSimple, Azure Backup, Azure SQL Database, content delivery networks and media services.
* Storage Services type: Blobs (in containers as block or page). Blob is also know as object storage), is unstructured object data.
* Storage Services types Tables (which have entities with field:value properties to NoSQL with no fixed schema), is structured data.
* Storage Services type: Queues (which have messages)
* Storage Services type: Files (via SMB shares)
* For infrastructure the big focus is on page blobs

### Azure Regions
* Storage Stamps are deployed to datacenters which live in an Azure Region
* An Azure Region has many datacenters that are wiithin a latency boundary
* There are Azure Regeions throughout the globe and more are added every year 
* Regions are paired for geo-redundant storage replication

### ASM (Azure Service Manager) / ARM ( Azure Resources Manager)
* Focus is on ARM as that is the new model for Azure that has support for RBAC, JSON templates, dependencies, tags. granular bullying and hybrid consistency via Azure Stack
* Cannot mix resources, if you still want that it needs to be through VPNs or Express Route or something else. So this is why use possible ARM for all deployments.

### Storage Accounts
* Every storage account has a globally-unique name throughtout the hole Azure Space
* Alle DNS names for specific types of service like blobs,queues, tables has also an unique name throughout the hole Azure space
* Account Types: General Purpose > general purpose accounts have a performance type
* Account Types: Blob storage > blob storage accounts are hot or cold tier, and these do not support page blobs, so I cannot use these for IaaS.
* Hot tier storage explained: I would use for data that I intend to access more. For a hot storage blob account I pay a certain amount for the storage, and a certain amount to access transactions.
* Cold tier storage explained: Very good for storing data I don't intend to access very often. For a cold storage account, the actual cost of storing data is about half of that of the hot tier, but the actual transactions frees are double that of the hot tier.
* Like all Azure Resource Manager (ARM)) resources, storage accounts are in a Resource Group
* Storage Account Replication types: Locally-redundant storage (LRS): Locally redundant storage. Locally redundant storage (LRS) replicates three copies of your data within the same data center you have your data in. The write requests you do with your storage are not committed until they are replicated to all three copies, which means it replicates synchronously.
* Storage Account Replication types: Zone-redundant storage (ZRS): When you store your data in a storage account using ZRS replication, you can continue to access and manage your data if an availability zone becomes unavailable. ZRS provides excellent performance and low latency. ZRS offers the same scalability targets as locally redundant storage (LRS)
* Storage Account Replication types: Geo-redundant storage (GRS): Geo-redundant storage (GRS) is designed to provide at least 99.99999999999999% (16 9's) durability of objects over a given year by replicating your data to a secondary region that is hundreds of miles away from the primary region. ... Read-access geo-redundant storage (RA-GRS) is based on GRS.
* Storage Account Replication types: Read-access geo-redundant storage (RA-GRS): Read-access geo-redundant storage (RA-GRS) maximizes availability for your storage account. RA-GRS provides read-only access to the data in the secondary location, in addition to geo-replication across two regions.

### Standard Storage
* Also referred to as Basic storage
* Baed on storage stamps primarily using HDDs
* VHD files are stored in page blobs
* A page blob has a 1 TB maximum size
* 500 Maximum IOPS per disk for Standard tier VM (300 IOPS for Basic)
* Up to 20.000 IOPS per Standard storage account
* Always stick to 40 disks maximum in a storage account
* The maximum size of a VHD is 1023 GB (overhead for 1GB)

### Bigger and Faster Standard Storage
* 500 IOPS and 1TB will not always be enough
* One option: Add multi disks then combine
* The combined volume has the aggregate size and performance. Combining 8 disk would enable 8 TB volume with 4000 IOPS.
* When combining no mirroring or parity is required
* Use simple virtual disks with storage space or RAID 0/striping
* Applications may have their own technologies such as SQL Server

### Pricing of Standard Storage
* Like all Azure services the storage is billed based on consumption and the type of service
* Items that impact the price: Capacity, how much data I'm actually storing
* Items that impact the price: Tier, this could be hot and cold or more about the Standard vs Premium
* Items that impact the price: Redundancy, is it (LRS) or/and (ZRS) or/and  (GRS) or/and (RA-GRS)
* Items that impact the price: Transactions, how many transactions are you performing against the storage
* Items that impact the price: Region, prices do vary based on the region

### Understanding Sparse Storage and Trim in Azure Storage
* Uses fixed size VHDs where the size of the VHD is provisioned at creation time.
* You pay for what you consume which would typically mean creating the smallest VHD that meets your need.
* Azure Storage uses sparse storage on the back end and also supports trim type operations. Therefor if your 1 TB VHD only 50 MB of data stored in it then only 50 MB of Azure Storage is actually used and therefor you pay for the 50 MB only. Not the same for Premium Storage. You only pay for the data you write to it, you pay for what you consume.

### Resizing Disks
* Always create disks to the maximum size
* It is possible to resize via REST API, PowerShell and the portal
* If used by a VM the VM must be deallocated from the fabric
* Once increased in size extend the volume inside the OS

### Azure Premium Storage
* A separate set of storage stamps based on SSD primarily with additional network connectivity
* Higher IOPS per disk
* Predictable IOPS rather than simply a possible maximum, there is a guareantee 
* Currently available as LRS "availability only"
* For Azure VM disks "only"
* Not sparse storage
* Cost based on the disk size not the data you write

### Using Premium Storage
* Premium storage can only be used by specific VM series: DS, DSv2, GS and FS
* Sepearate compute stamps with specific network connectivity
* Less temporay storage as its used for caching purposes
* Up to 80.000 IOPS and 2000 MB per second throughput per VM output
* VM can use a mix of standard and premium storage

### Practices for Azure Storage
* Keep track of disks per storage account (500 IOPS per disk, 20.000 per storage account, above 40 disks then occurs throtteling)
* Uses consisstent naming schemes for account and disks
* For disks ensure its easy to relate which VM is using the disk
* Storage and compute most be in the same region
* Use multiple disks to increase IOPS without increasing cost for storage standard storage (not the case for premium storage)
* Don't forget to backup your data

### Caching
* Three types of caching: No caching
* Three types of caching: Read caching
* Three types of caching: Read and write caching
* OS Disk - [ Read ] and [ write ] caching ( ARM,ASM R or RW)
* Data Disks - [ Read ] and [ write ] caching
* Many applications are sensitive to caching
* Application data should be stored on data disks, never the OS disk
* Temporary Drive: A series = HDD
* Temporary Drive: D, DG, G, GS series: = SSD
* Content is lost any time VM is reprovisioned to fabric (stop, start, resize)
* Temporary drive is only used by the pagefile.sys
* Should be used as a scratc drive, e.g. TempDB, Buffer Pool Extensions (SQL Server 2014)
* May need special steps to create content on temp if needed by applications
* [Using SSDs in Azure VMs to store SQL Server TempDB and Buffer Pool Extensions](https://cloudblogs.microsoft.com/sqlserver/2014/09/25/using-ssds-in-azure-vms-to-store-sql-server-tempdb-and-buffer-pool-extensions/)
* Temporary Drive Letter is D by default, can be changed through a few laps
* [Use the D: drive as a data drive on a Windows VM](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/change-drive-letter)

### Azure Files
* Provides and SMB 2.1 and 3.0 file share in Azure
* Usable within the Azure and externalyl via SMB 3 and port 445 is open to the internet
* Provies a shared file storage in Azure
* Can be mapped using standard SMB clients

### Encryption
* By default data is not encrypted at rest
* Best option is for you to own the encryption either through the application (e.g. SQL) or the OS
* Data at rest encryption is possible
* Third-party solutions exist for VM encryption
* Azure has native Windows and Linux encryption using BitLocker and DM-Crypt respectively
* Integrates with Azure Key Vault for key storage

### Other Storage in Azure
* Can use other types of virtual storage appliance in Azure via iSCSI or other IP based protocols
* It is not possible to place your own equipment at Azure Datacenters
* Using storage solutions on-premises from Azure would likely have latencies that were too high, even via ExpressRoute to be performant
* There are certain partnerships with ExpressRoute service providers to host storage solutions at their locations that can be used in Azure with very latencies.

### Storage Account Keys
* Two keys are provided; a primary and a secondary
* This enables a key to be changed without interruption to access
* keys should be protected and reset if compromised
* Can be accessed through the portal, powershell and rest
* It's possible to build complete solutions to store, roll and access

### Managing Azure with GUI
* CloudXplorer tool
* Micrososft Azure Storage Explorer

### Snapshots
* There is no VM checkpoint capability in Azure
* It is possible to perform blob snapshots which would not integrate with VSS inside the VM
* Through Powershell can create a solution that creates and reverts to snapshots as required
* Snapshots cannot outlive the source blob
* Can copy snapshots to other locations
* Consider Azure Backup or Caputure VM
* [Using snapshots with Azure IaaS VMs](https://www.youtube.com/watch?v=WP7-96KQJl0)

### Server-side Copy
* Possible to copy via client resulting in slow operation and egress charges
* When moving or copying large amounts of data between storage account can use Azure server-side asynchronous copy
* When copied between accounts in same region no egress charges
* Copy across subscriptions and regions
* Use PowerShell, AzCopy or other utilities

### StorSimple
* Store data in Azure
* Provides an on-premises storage appliance that utilizes the cloud providing "infinite" storage
* iSCSI > StorSimple > First SSD, then HDD and then it goes to Azure

### Virtual IP
* Azure has a huge number of public IP addresses which are constantly being added to
* [Microsoft Azure Datacenter IP Ranges](https://www.microsoft.com/en-us/download/confirmation.aspx?id=41653)
* It is dangerous to whitelist all of these as anyone can provision a VM in Azure which would mean you trust it
* Every time the cloud service or resource using a VIP is re-proivsioned the IP can change
* When the Cloud Service is stopped (suspended), it loses its a Public IP address. When starting its gets a new one
* Each cloud service also has a DNS name <cloud service>.cloudapp.net
* The DNS name is updated when the VIP changes
* Note that a VIP is simply a Public Instance IP (PIP) assigned to a load balancer rather than a VM (an actual NIC)
* It is possible to reserve static VIPs to keep even if a service is de-provisioned and re-provisioned
* Endpoints with a VIP: The cloud service VIP is used to provide access to VM services through endpoints
* Endpoints with a VIP: Endpoints enable a port on the VIP to be mapped to a port for a VM or group of VMs (load balanaced)
  
### Dynamic IPs
* Each VM in a Cloud Service automatically received a Dynamic IP (DIP)
* This was assigned via DHCP from the IP range assigned to the Cloud Service
* Every VM in a Cloud Service could communicate to all other VMs via its DIP in the same Cloud Service but not outside the Cloud Service except via VIPs and Endpoints
* There was no way to specify a specific IP for a VM using just Cloud Service networking

### Name Resolution in Cloud Services
* Azure DNS is exclusively used for nativce Cloud Service name resolution
* Provides a Dynamic DNS capability enebaling all VMs in the same cloud service to perform name resolution on all other VMs in the same Cloud Service
* Internet DNS resolution also supported

### Limitations of Cloud Service Networking
* No control over IP scheme
* No ability to assign IPs to VMs
* No control over DNS
* No communication outside the cloud service except via public communication methods
* No ability to link cloud service or to on-premises
* Which is why we have Virtual Networks and Cloud Serivce are dead with Azure Resource Manager

### Ingress vs Egress
* Data inboudn to Azure in ingress
* Data outbound from Azure is egress
* There are no charges for ingress
* There are charges for egress (unless using an unmetered ExpressRoute connection) from an Azure datacenter

### Virtual Network Basics
* A virtual network is a construct created in Azure
* Virtual networks live within a subscription wihtin a regio
* A virtual network has one or more IP ranges assigned to it
* DNS Servers can be configured that will be configured as part of the DHCP offer (Azure or Custom)
* Virtual subnets are created in the virtual network to break up the network range
* VMs are placed in virtual subnets
* All machines within a virtual network can communicate
* 4096 Private IPs per virtual network

### CIDR Notation
* Used in Virtual network configurations
* Combines the IP address and its associated network mask
* xxx.xxx.xxx.xxx/n
* xxx.xxx.xxx.xxx is the IP network
* N is the number of bits used for subnet mask, e.g. 24 would equate to 255.255.255.0
* 10.2.1.0/24 equates to IP range 10.2.1.0 to 10.2.1.255
* Commonly a range from RFC 1918 is used
* 10.0.0.0 - 10.255.255.255 (10/8 prefix)
* 172.16.0.0 - 172.31.255.255 (172.16/12 prefix)
* 192.168.0.0 - 192.168.255.255 (192.168/16 prefix)
* These are very useful there none internet-routable

### IP address range
* Also possible to leverage other IP ranges for organizations that own lrage public blocks
* Whatever IP range selected should not conflict with:
* On-premises networks
* Other virtual networks
* Within a virtual subnet certain IP addresses are resserverd for Azure's internal use
* First and last reseverd per protocol for host ID and broadcast
* The first three ip addresses are reseverd for Azure
* Binary 01,10 and 11 in the host ID portion of the IP address
* So /29 is the smallest you will ever use in Azure since the first 3 are used by Azure and the first one available is .4

### DNS and Virtual Networks
* DNS configuration is possible with a virtual network
* The Azure DNS can be used which provides name resolution for all services within the virtual network
* DNS servers can explicitly be configured such as your DCs
* The DNS configuration is applied to the VMs via DHCP
* VMs in Azure ALWAYS get their IP configuration via DHCP and never static configuration
* VMs must be restarted to get updated DNS configurations

### IP Support in a Virtual Network
* IPv4 today
* TCP, UDP and ICMP
* No multicast, broadcast, GRE packets or IP-in-IP packets
* IPv6 in the future
* Virtual networks are recommended but optional with Azure Service Manager (ASM)
* When used with ASM resolves the challanges of the nativce Cloud Service networking
* Virtual networks are mandatory with Azure Resource Manager (ARM)

### Static Addresses
* A VM always gets its IP address via DHCP in Azure
* Called a DIP with ASM but with ARM the terminology is Private IP
* NEVER try and assign a static IP, it will break at some point
* When a VM is reprovisioned to the fabric it gets a new vmNIC and possible a new IP
* Static IPs can be assigned via the Azure fabric using the portal or Powershell
* Create a separate subnet as the pool for the static IP assignments

### Traffic Flow in a Virtual Network
* By default for a VM in a virtual network it can communicate with
* Every other VM in every subnet in the same virtual network
* Antrhing on the Internet (outbound)
* Anything connected via a VPN or ExpressRoute

### Traffic Flow in a Virtual Network > This may not always be desired
* In a multi-tiered application may want only neighbor tiers to communicate
* May want onyl certain VMs to talk to the internet (DMZ)
* May want to restrict types of traffic

### Network Security Groups
* Enable rules to be created then assigned to a network security group
* Network security groups applied to subnets or VMs
* When applied to a subnet it is still enforced at the vmNIC, it is not an "Edge" device


### Network Securtiy Group Rule (NSG)
* Rules are based on 5-tuple and gave a priority and action (allow or deny)
* Source IP address (can be a range using CIDR format)
* Source port
* Destination IP address (can be a range using CIDR format)
* Destination port
* Protocol (TCP,UDP, or *)
* CIDR used to define source/destination
* Three special identifiers
* VIRTUAL_NETWORK: Identifies traffic within the virtual network address space
* AZURE_LOADBALANCER: the Azure infrastructure load balancer
* INTERNET: IP address space external to the virtual network

### Multi-NIC VMs
* By default a VM has a single vmNIC
* Depending on the size of the VM multiple NICs may be allowed
* [Sizes for Cloud Services](https://docs.microsoft.com/en-us/azure/cloud-services/cloud-services-sizes-specs)
* NICs must be added at time of provisioning
* Cannot mix single NIC and multi NIC VMs in same availibilty set
* vmNICs can be in the same or different subnet
* This is really designed for virtual appliances

### Customized Routing in a Virtual Network
* User Defined Routes (UDR)
* Enables modification of the default routing of packets
* Example: adding a firewall/IDS appliance that all traffic should flow through
* A virtual appliance could be added with multiple vmNICs with a NIC in each subnet and that IP is the default route for each subnet instead of the Azure default
* A route is created for an address prefix and next hop IP, added to a route table then applied to a subnet
* Also possible to just define next hop that points to a VM and Azure will handle the routing

### IP Address Types: ARM Terminology for IPs
* Private IP ( f.k.a. DIP) => Used within a virtual network and to systems connected via VPN. Assigned to VM, Internal Load Balancer (ILB) and application gateway
* Public IP (f.k.a VIP or PIP) => Communication from the Internet. Assigned to a VM, Internet-facing Load Balancer, VPN gateway and application gateways. Can be static or dynamic.

### Public IP Addresses
* An explicit resource used within a specific Azure region. Can be static or dynamic.
* Has an optional DNS name
* Once created can be assigned to a resource such as a load balancer or direct to a VM
* VM does not see the Public IP directly but all traffic sent to the Public IP is sent to the VM f.k.a. instance-level Public IP

### Load Balancer Basics
* Provide distribution of request to multiple targets. This enables ability to scale and resiliency from service downtime.
* Two types of Load Balancers Internet-facing Load Balancer: Balances incoming traffic from the Internet to VMs Azure
* Two types of Load Balancers Internal Load Balancer: BAlances traffic between VMs in a virtual network (or connected network)
* ASM vs ARM  Load Balancer: With ASM the cloud service provided Inter-facing Load Balancing services through its VIP and endpoints
* ASM vs ARM  Load Balancer: With ARM the load balancer is an explicit object created and can be internal or external. Arm load balancer can have a public IP address assigned (along with a DNS name for the Public IP)
* Load Balancer Modes: Works at network level (layer 4)
* Load Balancer Modes: Provide two types of services
* Load Balancer Modes: Provide two types of services: Hash-Based distribution > Actually balancing traffic between multiple targets
* Load Balancer Modes: Provide two types of services: Port forwaring > Directs incoming traffic to a port on the LB inbound IP and forwards to a port on specific target (NAT rules just like endpoints with cloud service VIP)

### Load Balancer Stickiness
* By default uses 5 typle: The source IP address
* By default uses 5 typle: The destination IP address
* By default uses 5 typle: The protocol type (TCP or UDP)
* By default uses 5 typle: The source port
* By default uses 5 typle: The destination port
* Can also use 2 or 3 tuple: SourceIP (2 tuple) - Source and destination IP only
* Can also use 2 or 3 tuple: SourceIPProtocol (3 typle) - As above but also protocol

### Traffic Manager
* There may be multiple deployments of a service in different locations and different regions
* Requirments to balance requests based on promixity to the requesting user, round-robin or failover
* Traffice Manager provides a DNS based distribution service incoming DNS request
* Targets can be VMs in Azure, Paas services, other Traffice Manager instrances and on-premises services
* Routing Method: Performances most of the time

### Hybrid Cloud Requirments
* Cross-cloud management
* Single provisioning system (examples: Portal and or ticket system)
* Network connectivity
* The last item has to be their first for Azure to be an extension of your datacenter
* Enables seamless connectivity without having to use internet facing access points
* The only services open to the internet should be services you want to offer to the internet and not RDP and WS-Man

### Routing between Azure and On-premises
* Must use unique IP address ranges
* It is not possible to route between networks that use the same IP scheme
* Includes on-premises to Azure
* Azure VN to Azure VN
* VMs cannot be moved between Virtual Networks without deleting and recreating
* Get the virtual networks rights the first time

### Azure Site-to-site VPN
* Provides connectivity between a virtual network and an on-premises network or another virtual network
* To on-premises connects over the internet
* Uses IPsec/IKE to encrypt the traffic
* VPN Gateway created in Azure as automatically created pair of VMs (hidden) in active-passive configuration
* On-premises compatible gateway device required
* Microsoft provides configuration file for certain gateways

### VPN Gateway Subnet
* Azure-side VPN gateway requires its own subnet
* Can use a /29 but recommended to use /27 to enable support for S2S and ExpressRoute gateway coexistence
* Common when creating subnets in new virtual networks is to leave an address space at the start to use for the gateway
* Do NOT use a NSG with gateway subnet

### Types of VPN Gateway
* IPSEC is computationally expensive which limits bandwidth
* Three SKUs of gateway (S2S/ExpressRoute)
* Basic - 100 Mbps/500 Mbps
* Standard - 100 Mbps/1000 Mbps
* High Performance - 200 Mbps/2000 Mbps
* Common to see 80 Mbps with Basic and Standard
* Latency will depend on many factors but expect 10's of milliseconds
* [https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-skus-legacy](https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-skus-legacy)

### Connecting Multiple networks
* Basic and Standard SKUs support 10 tunnels
* High Performance 30 tunnels
* These can be to on=premises networks connected over the Internet or to other virtual networks via the Azure backbone
* Virtual networks can be in different regions and different subscriptions
* Traffic outside the regions/datacenter would result in egress traffic charges
* Azure will not act as router between locations
* Forced Tunneling: Typically traffice not destined for a know connected network is sent out via the Internet
* Forced Tunneling: Forced tunneling configures all traffic including that which would normally route via the Internet to a specific route
* Forced Tunneling: Uses User Defined Routes (UDRs)
* Forced Tunneling: Only possible with route-based (dynamic) gateway
* Forced Tunneling: Configured on a per subnet basis

### Network Peering
* Normally to connect virutal networks you must use site-to-site VPN or EpxressRoute
* Network peering enables virtual networks to be connected via the Azure backbone network
* Low latency, high bandwith
* Must be in the same region
* No overlap in IP scheme
* Can be in different subscriptions
* No derived transitive connection

### Point-to-site VPN
* Site-to-site: Connects a network to Azure virtual network
* Point-to-site: Connects a single machine to Azure virtual network
* Point-to-site: P2S IP range configured to use for the VPN clients
* Point-to-site: Only works with route-based (dynamic gateway)
* Point-to-site: Clients install Azure P2S client

### Site-to-site VPN Challanges
* It uses the internet
* Bandwith
* Unpredictable latency
* Security may not the requirements
* Potentially greater networking costs

### ExpressRoute
* Provides layer 3 connectivity from your location to Azure over a private connection
* ExpressRoute provides: Predictable performances
* ExpressRoute provides: High throughput
* ExpressRoute provides: SLA
* ExpressRoute provides: Redundancy (Every ExpressRoutes actually consists of two connections)
* ExpressRoute provides: Does NOT use the Internet so does not need to encrypt
* ExpressRoute Deployment Models: Using a cloud exchange co-location
* ExpressRoute Deployment Models: Point-to-point Ether connection <Exchange provider>
* ExpressRoute Deployment Models: Any-to-any (IPVPN) connection (network service provider)

### ErxpressRoute Forced Tunneling
* Uses BGP for routing enabling forced tunneling
* Care should be taken as if all traffic is forced through customer location that would include access to other Azure services like storage
* Rules should be structured so that Azure services (public peering) still route via Azure backbone and not via on-premises location

### ExpressRoute Providers and costs
* There are providers throughout the world
* Costs vary based on speed, metered or un-metered and the premium add-on
* [ExpressRoute partners and peering locations](https://docs.microsoft.com/en-us/azure/expressroute/expressroute-locations)
* [ExpressRoute Pricing](https://azure.microsoft.com/en-us/pricing/details/expressroute/)
* Various Costs to Consider: ExpressRoute
* Various Costs to Consider: Egress (if metered)
* Various Costs to Consider: ExpressRoute Gateway
* Various Costs to Consider: Service provider costs

### Services Access
* When connecting via ExpressRoute all services in the geo-political boundary can be accessed via the connection
* With ExpressRoute premium all services throughout the world can be accessed by the connection
* Single ExpressRoute can be connected to multiple virtual networks which then allow them to communicate
* ExpressRoute and S2S VPN can co-locate with S2S a fallback
* Types of Peering: Site-to-site VPN is private peering connecting to a virtual network
* Types of Peering: ExpressRoute also supports public and Microsoft peering
* Types of Peering: Public peering provides access to nearly all Azures services via ExpressRoute instead of the Internet
* Types of Peering: Micrososft peering provides access to Office 365 and CRM online and requires Premium add-on
* Types of Peering: Single ExpressRoute provides 3 service keys, one for each type
* Types of Peering: Service provider may charge separatly

### Deploying ExpressRoute
* Can be managed through PowerShell and portal
* Work with your service provider primarily
* The service provider can assist with the actions required on the Azure side to acquire the service key
* [Connect a virtual network to an ExpressRoute circuit using the portal](https://docs.microsoft.com/en-us/azure/expressroute/expressroute-howto-linkvnet-portal-resource-manager)

### Introduction to IaaS
* Provides virtual machines in Azure
* The networking, storage, compute, and hypervisor are all managed by Microsoft
* You manage: Applications, Data Runtime, Middleware, O/S
* Vendor manages: Virtualization, Servers, Storage, Networking
* Everything wihtin the VM is within the customers control, including: The operating system
* Everything wihtin the VM is within the customers control, including: Runtimes and libraries
* Everything wihtin the VM is within the customers control, including: Applications
* Everything wihtin the VM is within the customers control, including: Data
* Also means everything in the VM needs to be managed and maintained by the customer
* Azure VMs reply on other Azure services including: Resource group, Storage, Networking
* It is vital to architect the subscriptions, resources groups, storage accounts, and the networks before creating VMs
* Azure VM options: Numerous VM series exist that offer different capabilities
* Azure VM options: Some series have tiers: basic and standard
* Within the series there are different sizes that relate to: Number of cores with performance measured in Azure Compute Units (ACUs)
* Within the series there are different sizes that relate to: Amount of RAM
* Within the series there are different sizes that relate to: Amount of temporary storage
* Within the series there are different sizes that relate to: Number of data disks
* Within the series there are different sizes that relate to: Number and type of network adapters
* Within the series there are different sizes that relate to: Network performance
* Can't create custom sizes, btu there are a lot to choose from
* Some have a v2 which run on newer stamps and offer increased processor performance
* Series A: General purpose VMs with HDD temporary drive
* Series D: SSD temporary drives with faster processors than A serie
* Series F: Compute optimizes with 2 GB of RAM and 16 GB of SSD per core
* Series G: Performance computer with massive scale and SSD temporary drives
* Series N: GPU capabilities for graphical intensive workloads 
* An S suffix to the series denotes it can use Premium Storage
* For example the DSv2 series
* [General purpose virtual machine sizes](https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sizes-general)
* Public cloud services are consumption based
* You only pay for services as you use them
* For example: a VM running for 2 days a month is only charged for 2 days a month

